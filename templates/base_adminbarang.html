<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}{% endblock %}Admin Barang</title>
  <link rel="stylesheet" href="/static/css/global.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  {% block css %}
  {% endblock %}
  <link rel="icon" type="image/png" href="/static/img/logo rs.png" />
  <style>
    .notification-badge {
      position: relative;
      display: inline-block;
    }

    .notification-badge .badge {
      position: absolute;
      top: -10px;
      right: -10px;
      padding: 5px 10px;
      border-radius: 50%;
      background: red;
      color: white;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <!-- =============== Navigation ================ -->
  <div class="container">
    <div class="navigation">
      <ul>
        <li>
          <a href="/adminbarang">
            <span class="icon">
              <img src="/static/img/logo rs.png" width="65" height="65" style="margin-top: 10px" />
            </span>
            <span class="title" style="margin-top: 10px">RSUD DR.DARSONO</span>
          </a>
        </li>

        <li {% if '/adminbarang' in request.path %} class="hovered" {% endif %}>
          <a href="/adminbarang">
            <span class="icon">
              <ion-icon name="home-outline"></ion-icon>
            </span>
            <span class="title">Dashboard</span>
          </a>
        </li>

        <div style="margin-bottom: 20px; margin-top: 20px">
          <span style="color: white; font-size: large">Master Data</span>
        </div>

        <li {% if '/kategori' in request.path %} class="hovered" {% endif %}>
          <a href="/kategori">
            <span class="icon">
              <ion-icon name="layers-outline"></ion-icon>
            </span>
            <span class="title">Kategori</span>
          </a>
        </li>

        <li {% if '/satuan' in request.path %} class="hovered" {% endif %}>
          <a href="/satuan">
            <span class="icon">
              <ion-icon name="layers-outline"></ion-icon>
            </span>
            <span class="title">Satuan</span>
          </a>
        </li>

        <li {% if '/barang' in request.path %} class="hovered" {% endif %}>
          <a href="/barang">
            <span class="icon">
              <ion-icon name="bag-handle-outline"></ion-icon>
            </span>
            <span class="title">Data Barang</span>
          </a>
        </li>

        <div style="margin-bottom: 20px; margin-top: 20px">
          <span style="color: white; font-size: large">Barang</span>
        </div>

        <li {% if '/barangmasuk' in request.path %} class="hovered" {% endif %}>
          <a href="/barangmasuk">
            <span class="icon">
              <ion-icon name="arrow-undo-outline"></ion-icon>
            </span>
            <span class="title">Barang Masuk</span>
          </a>
        </li>

        <li {% if '/barangkeluar' in request.path %} class="hovered" {% endif %}>
          <a href="/barangkeluar">
            <span class="icon">
              <ion-icon name="arrow-redo-outline"></ion-icon>
            </span>
            <span class="title">Barang Keluar</span>
          </a>
        </li>

        <li {% if '/kartustock' in request.path %} class="hovered" {% endif %}>
          <a href="/kartustock">
            <span class="icon">
              <ion-icon name="card-outline"></ion-icon>
            </span>
            <span class="title">Kartu Stock</span>
          </a>
        </li>

        <div style="margin-bottom: 20px; margin-top: 20px">
          <span style="color: white; font-size: large">Stock Barang</span>
        </div>

        <li {% if '/stocktersedia' in request.path %} class="hovered" {% endif %}>
          <a href="/stocktersedia">
            <span class="icon">
              <ion-icon name="cube-outline"></ion-icon>
            </span>
            <span class="title">Stock Tersedia</span>
          </a>
        </li>

        <li {% if '/stockminimum' in request.path %} class="hovered" {% endif %}>
          <a href="/stockminimum">
            <span class="icon">
              <ion-icon name="trending-down-outline"></ion-icon>
            </span>
            <span class="title">Stock Minimum</span>
          </a>
        </li>

        <div style="margin-bottom: 20px; margin-top: 20px">
          <span style="color: white; font-size: large">Laporan</span>
        </div>

        <li {% if '/laporan-barang' in request.path %} class="hovered" {% endif %}>
          <a href="/laporan-barang">
            <span class="icon">
              <ion-icon name="documents-outline"></ion-icon>
            </span>
            <span class="title">Laporan Barang</span>
          </a>
        </li>

        <li {% if '/laporan-barang-per-bulan' in request.path %} class="hovered" {% endif %}>
          <a href="/laporan-barang-per-bulan">
            <span class="icon">
              <ion-icon name="documents-outline"></ion-icon>
            </span>
            <span class="title">Laporan Barang Per Bulan</span>
          </a>
        </li>

        <li {% if '/laporan-stock' in request.path %} class="hovered" {% endif %}>
          <a href="/laporan-stock">
            <span class="icon">
              <ion-icon name="documents-outline"></ion-icon>
            </span>
            <span class="title">Laporan Stock</span>
          </a>
        </li>

        <li {% if '/laporan-persediaan' in request.path %} class="hovered" {% endif %}>
          <a href="/laporan-persediaan">
            <span class="icon">
              <ion-icon name="documents-outline"></ion-icon>
            </span>
            <span class="title">Laporan Persediaan</span>
          </a>
        </li>

        <li {% if '/logout' in request.path %} class="hovered" {% endif %}>
          <a href="logout">
            <span class="icon">
              <ion-icon name="log-out-outline"></ion-icon>
            </span>
            <span class="title">Logout</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- ========================= Main ==================== -->
    <div class="main">
      <div class="topbar">
        <div class="toggle">
          <ion-icon name="menu-outline"></ion-icon>
        </div>

        <div class="">
          <h1>Admin Barang</h1>
        </div>

        <a href="/stockminimum">
          <div class="notifications">
            <ion-icon name="notifications"></ion-icon>
            <div id="notification-badge" class="notification-badge" style="display: none;">
              <span id="notification-count" class="badge"></span>
            </div>
          </div>
        </a>
      </div>

      {% block content %}
      {% endblock %}

    </div>
  </div>

  <!-- =========== Scripts =========  -->
  <script>
    let list = document.querySelectorAll(".navigation li");

    function activeLink() {
      list.forEach((item) => {
        item.classList.remove("hovered");
      });
      this.classList.add("hovered");
    }

    list.forEach((item) => item.addEventListener("mouseover", activeLink));

    let toggle = document.querySelector(".toggle");
    let navigation = document.querySelector(".navigation");
    let main = document.querySelector(".main");

    toggle.onclick = function () {
      navigation.classList.toggle("active");
      main.classList.toggle("active");
    };
  </script>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <script>
    // Fungsi untuk mendapatkan jumlah item yang mencapai stock_minimum
    async function fetchItemsBelowMinimum() {
      try {
        const response = await fetch('/api/items_below_minimum');
        const data = await response.json();
        const itemsBelowMinimum = data.items_below_minimum;

        if (itemsBelowMinimum > 0) {
          document.getElementById('notification-count').textContent = itemsBelowMinimum;
          document.getElementById('notification-badge').style.display = 'inline-block';
        } else {
          document.getElementById('notification-badge').style.display = 'none';
        }
      } catch (error) {
        console.error('Error fetching items below minimum:', error);
      }
    }

    // Panggil fungsi fetchItemsBelowMinimum saat halaman dimuat
    document.addEventListener('DOMContentLoaded', fetchItemsBelowMinimum);
  </script>
  {% block js %}
  {% endblock %}
</body>

</html>